{% extends 'base.html' %}
{% set page = 'aliments' %}
{% include "navbar.html" %}
{% include "flash_messages.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">
<div class="content">
<h1 class="title">{% block title %} Aliments {% endblock %}</h1>
<div class="content_aliments bg-light">
    <div>
        <form method="POST" action="{{ url_for('ajouter_aliment') }}"  enctype="multipart/form-data">
            <div class="form-row">
                <div class="input-group mb-3 col-md-6">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="titre">Titre</span>
                    </div>
                    <input type="text" id="titre" name="titre" class="form-control" placeholder="Titre" required>
                </div>
                <div class="input-group mb-3 col-md-6">
                    <input type="number" id="kcal" name="kcal" class="form-control" placeholder="Kcal" required>
                    <div class="input-group-append">
                        <span class="input-group-text" id="kcal">Kcal</span>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="input-group mb-3 col-md-4">
                    <input type="number" id="proteines" name="proteines" class="form-control" placeholder="Protéines" required>
                    <div class="input-group-append">
                        <span class="input-group-text" id="proteines">Protéines</span>
                    </div>
                </div>
                <div class="input-group mb-3 col-md-4">
                    <input type="number" id="glucides" name="glucides" class="form-control" placeholder="Glucides" required>
                    <div class="input-group-append">
                        <span class="input-group-text" id="glucides">Glucides</span>
                    </div>
                </div>
                <div class="input-group mb-3 col-md-4">
                    <input type="number" id="lipides" name="lipides" class="form-control" placeholder="Lipides" required>
                    <div class="input-group-append">
                        <span class="input-group-text" id="lipides">Lipides</span>
                    </div>
                </div>  
            </div>
            <div class="form-row">
                <div class="input-group mb-3 col-md-6">
                    <select id="categorie" name="categorie" class="form-control" required>
                        <option value="légume">Légume</option>
                        <option value="boisson">Boisson</option>
                        <option value="féculent">Féculent</option>
                        <option value="fruit">Fruit</option>
                        <option value="légumineuse">Légumineuse</option>
                        <option value="matière grasse">Matière grasse</option>
                        <option value="produit laitier">Produit laitier</option>
                        <option value="poisson">Poisson</option>
                        <option value="viande">Viande</option>
                        <option value="sucrerie">Sucrerie</option>
                        <option value="autre">Autre</option>
                    </select>    
                </div>
                <div class="input-group mb-3 col-md-6">
                    <input class="form-control" type="file" id="fichier_photo" name="fichier_photo">
                </div>
            </div>
            
            <div class="form-row">
                <div class="input-group mb-3 col-md-9">
                    <span class="input-group-text">Description</span>
                    <textarea class="form-control" id="description" name="description" aria-label="With textarea"></textarea>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" id="unite" name="unite" type="checkbox">
                    <label class="form-check-label" for="unite">Unité</label>
                </div>
            </div>
            <div class="form-row text-center" style="padding-bottom: 0.5cm;">
                <div class="col-md-12">
                    <input type="submit" value="Ajouter" class="btn btn-primary">
                </div>
            </div>
        </form>               
    </div>
</div>
<div class="form-row" style="padding-top: 0.5cm;">
    <div class="input-group mb-3 col-md-4">
        <form id="search-form">
            <input id="searchbar_aliment" onkeyup="search_aliment()" type="text" name="search" class="form-control" placeholder="Rechercher un aliment" aria-label="Rechercher un aliment" aria-describedby="button-addon2">
        </form>
    </div>
    <div class="input-group mb-3 col-md-6">
        <form method="post" action="{{ url_for('importer_csv_aliment') }}" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-10">
                    <div class="mb-3">
                        <input class="form-control" type="file" id="fichier_aliment" name="fichier_aliment" onchange="checkFileSelectedAliment()">
                    </div>
                </div>
                <div class="col-md-2 align-items-center">
                    <button type="submit" class="btn btn-primary" id="bouton_importer_aliment" disabled>Importer</button>
                </div>
            </div>
        </form>
    </div>  
    <div class="mb-3 col-md-2">
        <a href="{{ url_for('export_csv_aliment') }}" class="btn btn-primary">Exporter</a>
    </div>
</div>
        <table class="table table-striped table-bordered">
            <tr>
                <th>Titre</th>
                <th>Kcal</th>
                <th>Protéines</th>
                <th>Glucides</th>
                <th>Lipides</th>
                <th>Catégorie</th>
                <th>Unité</th>
                <th>Modifier</th>
                <th>Supprimer</th>
            </tr>
            {% for aliment in aliments %}
            <tr class="element_aliment_liste">
                <td style="width: 20%">{{ aliment.titre }}</td>
                <td style="width: 10%">{{ aliment.kcal }}</td>
                <td style="width: 10%">{{ aliment.proteines }}</td>
                <td style="width: 10%">{{ aliment.glucides }}</td>
                <td style="width: 10%">{{ aliment.lipides }}</td>
                <td style="width: 10%">{{ aliment.categorie }}</td>

                {% if aliment.unite == 1 %}
                <td style="width: 10%">pour 100 g</td>
                {% else %}
                <td style="width: 10%">pour 1 portion</td>
                {% endif %}
                <td style="width: 10%">
                    <a href="{{ url_for('modifier_aliment', id=aliment.id) }}" class="btn btn-sm btn-primary">➜</a>
                </td>
                <td style="width: 10%">
                    <a href="{{ url_for('supprimer_aliment', id=aliment.id) }}" class="btn btn-sm btn-outline-danger">X</a>
                </td>
            </tr>
            {% endfor %}
        </table>
</div>

<script>
    function search_aliment(){
    let input = document.getElementById('searchbar_aliment').value
    input=input.toLowerCase();
    let x = document.getElementsByClassName('element_aliment_liste');
        
      for (i = 0; i < x.length; i++) { 
          if (!x[i].innerHTML.toLowerCase().includes(input)) {
              x[i].style.display="none";
          }
          else {
              x[i].style.display="table-row";                 
          }
      }
}

function checkFileSelectedAliment() {
    var fileInput = document.getElementById('fichier_aliment');
    var button = document.getElementById('bouton_importer_aliment');
    if (fileInput.files.length > 0) {
        button.disabled = false;
    }
    else {
        button.disabled = true;
    }
}
</script>

{% endblock %}