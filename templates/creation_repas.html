{% extends 'base.html' %}
{% include "navbar.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">

<!-- Ajout des scripts JavaScript et des styles Bootstrap -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<div class="content">
  <h1 class="title">{% block title %} Composition repas : {% endblock %}</h1>
  <div>
    <table class="table table-striped table-bordered">
      <tr>
        <th>Titre</th>
        <th>Kcal</th>
        <th>Protéines</th>
        <th>Description</th>
        <th>Quantité</th>
        <th>Enlever</th>
      </tr>
      {% for portion in portions_from_meal %}
      <tr>
        <td>{{ portion.aliment_obj.titre }}</td>
        <td>{{ portion.aliment_obj.kcal }}</td>
        <td>{{ portion.aliment_obj.proteines }}</td>
        <td>{{ portion.aliment_obj.description }}</td>
        <td>{{ portion.nombre }}</td>
        <td>
          <a href="{{ url_for('remove_from_meal', id=portion.aliment_obj.id, diete_id=repas_id) }}" class="btn btn-primary">Enlever</a>
        </td>
      </tr>
      {% endfor %}
    </table>        
  </div>
  <div>
    <h2 class="title">Ajouter des aliments :</h2>
    <table class="table table-striped table-bordered">
      <tr>
        <th>Titre</th>
        <th>Kcal</th>
        <th>Protéines</th>
        <th>Catégorie</th>
        <th>Description</th>
        <th>Ajouter</th>
      </tr>
      {% for aliment in aliments %}
      <tr>
        <td>{{ aliment.titre }}</td>
        <td>{{ aliment.kcal }}</td>
        <td>{{ aliment.proteines }}</td>
        <td>{{ aliment.categorie }}</td>
        <td>{{ aliment.description }}</td>
        <td>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal{{ aliment.id }}">Ajouter</button>
          <!-- Fenêtre modale -->
          <div class="modal fade" id="modal{{ aliment.id }}" tabindex="-1" aria-labelledby="modal{{ aliment.id }}Label" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modal{{ aliment.id }}Label">Ajouter la quantité</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <label for="quantite{{ aliment.id }}">Quantité :</label>
                  <input type="number" id="quantite{{ aliment.id }}" class="form-control" min="0">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                  <a href="{{ url_for('add_to_meal', id=aliment.id, diete_id=repas_id) }}" class="btn btn-primary" onclick="ajouterQuantite('{{ aliment.id }}')">Valider</a>
                </div>
              </div>
            </div>
          </div>
          <!-- Fin de la fenêtre modale -->
        </td>
      </tr>
      {% endfor %}
    </table>
    <div>
      <a href="{{url_for('aliments')}}" class="btn btn-primary">Créer un aliment</a>
    </div>
  </div>
</div>

<script>
  function ajouterQuantite(alimentId) {
    var quantite = document.getElementById("quantite" + alimentId).value;
    var lienAjouter = document.querySelector("a[href='" + alimentId + "']");
    lienAjouter.href += "&quantite=" + quantite;
  }
</script>

{% endblock %}
